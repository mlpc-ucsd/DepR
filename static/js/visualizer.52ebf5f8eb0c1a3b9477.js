import*as t from"https://cdn.jsdelivr.net/npm/three@0.148.0/build/three.module.js";import{TrackballControls as e}from"https://cdn.jsdelivr.net/npm/three@0.148.0/examples/jsm/controls/TrackballControls.js";import{GLTFLoader as n}from"https://cdn.jsdelivr.net/npm/three@0.148.0/examples/jsm/loaders/GLTFLoader.js";var i={129:(e,n,i)=>{e.exports=(t=>{var e={};return i.d(e,t),e})({AmbientLight:()=>t.AmbientLight,Color:()=>t.Color,DoubleSide:()=>t.DoubleSide,LoadingManager:()=>t.LoadingManager,Matrix4:()=>t.Matrix4,MeshStandardMaterial:()=>t.MeshStandardMaterial,PerspectiveCamera:()=>t.PerspectiveCamera,PointLight:()=>t.PointLight,Scene:()=>t.Scene,Vector3:()=>t.Vector3,WebGLRenderer:()=>t.WebGLRenderer,sRGBEncoding:()=>t.sRGBEncoding})},247:(t,e,n)=>{n.d(e,{A:()=>s});var i=n(129);class s extends i.PerspectiveCamera{K;imageWidth;imageHeight;constructor(t,e,n,i,s,o){super(45,i,s,o),this.K=t,this.imageWidth=e,this.imageHeight=n,this.updateProjectionMatrix()}updateProjectionMatrix(){if(!this.K)return;const t=this.K[0][0],e=this.K[1][1],n=this.K[0][2],s=this.K[1][2],o=this.K[0][1],a=this.imageWidth/this.imageHeight,r=this.aspect/a,c=Math.max(1,r),l=Math.max(1,1/r),d=(1-c)/2*this.imageWidth,h=(1-l)/2*this.imageHeight,p=d,g=this.imageWidth-d,m=h,u=this.imageHeight-h,f=function(t,e,n,s,o,a,r){const c=a+r,l=a*r,d=new i.Matrix4;return d.set(e,t,s,0,0,n,o,0,0,0,-c,l,0,0,1,0),d}(o,t,e,n,s,this.near,this.far),b=function(t,e,n,s,o,a){const r=-(e+t)/(e-t),c=-(s+n)/(s-n),l=-(a+o)/(a-o),d=new i.Matrix4;return d.set(2/(e-t),0,0,r,0,2/(s-n),0,c,0,0,-2/(a-o),l,0,0,0,1),d}(p,g,u,m,this.near,this.far),x=new i.Matrix4;x.set(1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1);const w=b.multiply(f).multiply(x);this.projectionMatrix.copy(w),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}}}},s={};function o(t){var e=s[t];if(void 0!==e)return e.exports;var n=s[t]={exports:{}};return i[t](n,n.exports,o),n.exports}o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var a=o(129),r=o(247);const c=new a.LoadingManager,l=new a.MeshStandardMaterial({roughness:.6,metalness:.1,side:a.DoubleSide,color:9626620}),d=$(".loading-overlay");c.onStart=()=>{d.css("display","flex")},c.onLoad=()=>{d.css("display","none")};const h=$("#canvas-scene"),p=new a.WebGLRenderer({canvas:h[0],antialias:!0});p.setPixelRatio(window.devicePixelRatio),p.setClearColor(16777215,1),p.physicallyCorrectLights=!0,p.outputEncoding=a.sRGBEncoding;let g=null;function m(t){if(g){const e=$("#"+g);e.toggleClass("is-info",t),e.toggleClass("is-light",!t)}}function u(t,e,n){const i=$("<button></button>").text(e).attr("id",`c-${e}`).addClass("button is-light").on("click",n);return $(t).append(i),`c-${e}`}async function f(t){const i=[],s=$("#scene-img");s.attr("src",`static/scenes/${t}/rgb.webp`);const o=new a.Scene;o.background=new a.Color(16777215);const h=await(await fetch(`static/scenes/${t}/specs.json`)).json(),f=h.W/h.H;p.setSize(s.width(),s.width()/f);const b=new r.A(h.K,h.W,h.H,f,.1,1e3),x=(new a.Vector3).fromArray(h.translation).multiplyScalar(h.scale),w=new a.Vector3(h.scale,h.scale,h.scale);b.position.copy(x);const y=new a.AmbientLight(16777215,1);o.add(y);const v=new a.PointLight(16777215,3*h.scale);o.add(v),v.position.copy(x);new n(c).load(`./static/scenes/${t}/recon.glb`,function(t){t.scene.children[0].children.forEach(t=>{t.material.roughness=l.roughness,t.material.metalness=l.metalness,t.material.side=l.side,t.material.color=l.color,t.scale.copy(w),t.position.copy(x),i.push(t)}),i.forEach(t=>{!function(t,e){e.rotation.z+=Math.PI,t.add(e)}(o,t)})});const M=new e(b,p.domElement);M.target.x=x.x,M.target.y=x.y;const L=function(){requestAnimationFrame(L),M.update(),p.render(o,b)};L(),c.onLoad=()=>{const t=$("#comp-buttons");t.empty();const e=i.length;function n(t){const e=$(t.currentTarget)[0],n=parseInt(e.id.split("-")[1]);i.forEach((t,e)=>{t.visible=e===n-1}),m(!1),g=e.id,m(!0)}for(let i=1;i<=e;i++)u(t,i,n);g=u(t,"All",function(t){const e=$(t.currentTarget)[0];i.forEach(t=>{t.visible=!0}),m(!1),g=e.id,m(!0)}),m(!0),d.css("display","none")}}["0","1","2","3","4","5"].forEach(t=>{$("#btn-s"+t).on("click",function(){f(t)})}),$(function(){f("0")});